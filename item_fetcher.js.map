{"version":3,"sources":["item_fetcher.js"],"names":["xmlRegexp","parseHistory","xml","match","map","eventXML","result","event","exec","key","value","split","replace","onmessage","data","startDate","endDate","console","log","fetch","then","response","text","items","postMessage","sort","Math","random","slice"],"mappings":";AA6BA,SAAA,EAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,wDAAA,SAAA,EAAA,EAAA,GAAA,IAAA,EAAA,GAAA,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAAA,IAAA,IAAA,EAAA,EAAA,EAAA,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,QAAA,EAAA,KAAA,EAAA,QAAA,GAAA,EAAA,SAAA,GAAA,GAAA,IAAA,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAAA,OAAA,EAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,OAAA,EA7BA,IAAMA,EAAY,8BACZC,EAAe,SAAAC,GACnBA,OAAAA,EAAIC,MAAM,iCACPC,IAAI,SAAAC,GAKGC,IAJAC,IAEFD,EAFEC,EAAQ,GAIRD,EAASN,EAAUQ,KAAKH,IAAW,CACRC,IADQ,EAAA,EACRA,EADQ,GACvBG,GADuB,EAAA,GAAA,EAAA,IAClBC,EADkB,EAAA,GAGrCH,EAAME,GADI,SAARA,EACWC,EAAMC,MAAM,KACR,gBAARF,EACIC,EACVE,QAAQ,yBAA0B,MAClCA,QAAQ,OAAQ,IAChBA,QAAQ,WAAY,UACpBA,QAAQ,eAAgB,WACxBA,QAAQ,WAAY,UACpBA,QAAQ,mBAAoB,IAC5BA,QAAQ,+BAAgC,QACxCA,QAAQ,kCAAmC,IAEjCF,EAGVH,OAAAA,KAGbM,UAAY,SAA2C,GAAA,IAAA,EAAA,KAAhCC,EAAAA,EAAAA,KAAQC,EAAAA,EAAAA,UAAWC,EAAAA,EAAAA,QAExCC,QAAQC,IAAI,CAAEH,UAAAA,EAAWC,QAAAA,IAGzBG,MAAM,iBACHC,KAAK,SAAAC,GAAYA,OAAAA,EAASC,SAC1BF,KAAK,SAAAlB,GACEqB,IAAAA,EAAQtB,EAAaC,GAC3B,EAAKsB,YAAY,CAAED,MAAOA,EAAME,KAAK,WAAMC,OAAAA,KAAKC,SAAW,KAAKC,OAAO","file":"item_fetcher.js","sourceRoot":"..","sourcesContent":["const xmlRegexp = /<([^/].*?)>(.*)(?=<\\/\\1>)/g;\nconst parseHistory = xml =>\n  xml.match(/(?<=<event>).*?(?=<\\/event>)/g)\n    .map(eventXML => {\n      const event = {};\n\n      let result;\n      // eslint-disable-next-line no-cond-assign\n      while(result = xmlRegexp.exec(eventXML)) {\n        const [ _match, key, value ] = result;\n        if (key === 'date') {\n          event[key] = value.split('/');\n        } else if (key === 'description') {\n          event[key] = value\n            .replace(/^<!\\[CDATA\\[(.*)\\]\\]>$/, '$1')\n            .replace(/^\\s+/, '')\n            .replace(/ampnbsp/g, '&nbsp;')\n            .replace(/ampampndash/g, '&ndash;')\n            .replace(/ampquot/g, '&quot;')\n            .replace(/ampref .*?\\/amp/g, '')\n            .replace(/{{convert|(.*?)|(.*?)|.*?}}/g, '$1$2') // {{convert|600|ft|m|sing=on}}\n            .replace(/(ampamp)?{{cite .*?}}(ampamp)?/g, '');\n        } else {\n          event[key] = value;\n        }\n      }\n      return event;\n    });\n\nonmessage = function({ data: { startDate, endDate } }) {\n\n  console.log({ startDate, endDate });\n  // &limit=100&related=true\n  // fetch(`http://www.vizgr.org/historical-events/search.php?begin_date=${startDate ? startDate.toArgs().slice(0,3).join('') : '20000101'}&end_date=${endDate ? endDate.toArgs().slice(0,3).join('') : '20001231'}`)\n  fetch('./history.xml')\n    .then(response => response.text())\n    .then(xml => {\n      const items = parseHistory(xml);\n      this.postMessage({ items: items.sort(() => Math.random() - 0.5).slice(-100) })\n    });\n}"]}